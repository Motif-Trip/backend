<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.ssafy.motif.app.domain.mapper.ImageMapper">
	<resultMap type="ProfileImage" id="profilePic">
		<result column="image_id" property="imageId" />
		<result column="member_id" property="memberId" />
		<result column="original_name" property="originalName" />
		<result column="stored_name" property="storedName" />
		<result column="image_url" property="imageUrl" />
	</resultMap>
	
	<insert id="profilePicAdd" parameterType="ProfileImage">
		<selectKey order="BEFORE" keyProperty="memberId" resultType="Long">
			select member_id
			from members
			where email=#{email}
		</selectKey>
		INSERT INTO profileimages(member_id, original_name,
			stored_name, image_url)
		VALUES(#{memberId}, #{originalName},
			#{storedName}, #{imageUrl})
	</insert>
	
	<select id="profilePicLoad" parameterType="String" resultMap="profilePic">
		SELECT profileImageId, m.email, originalName, storedName, imageUrl
		FROM profileimages p INNER JOIN members m
		ON m.member_id=p.member_id
		WHERE m.email=#{email}
	</select>
	
	<delete id="profilePicRemove" parameterType="String">
			DELETE
			FROM profileimages p
			INNER JOIN members m
			ON p.member_id=p.member_id
			WHERE m.email=#{email}
	</delete>
</mapper>